<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Gothamist Archive Retrieval Tool ðŸ“„</title>
    <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://rawgit.com/rufuspollock/s3-bucket-listing/gh-pages/list.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
  <style>
    p {
        max-width:34em;
    }
  </style>
  </head>
  <body>
    <div class="m-2">
      <h1>Gothamist Archive Retrieval Tool ðŸ“„</h1>
      <p>
        If you wrote for Gothamist (EDIT: or ANY OTHER -ist site) and would like to retrieve your clips,
        we've written a tool that will retrieve them from the Google AMP caches.
        Enter your name below (as credited on the Gothamist author pages) and our
        server will start retrieving them from the caches and post a link below.
        There is a rate limit on Google's AMP API so please be patient for your folder to show up.
        Caches expire so this may only work for a day at best.
      </p>
      <p>
        Hopefully this won't be too buggy, good luck and thank you for your reporting!
      </p>
      <p>
        Made by <a href='https://twitter.com/xn9q8h'>@xn9q8h</a> and <a href='https://twitter.com/turtlekiosk'>@turtlekiosk</a>
      </p>
      <label for="nameInput">
        Your Name (As Credited on Gothamist)
        <br/>
        <input type="text" placeholder="Your Name" id="nameInput" />
      </label>
      <button id="submitButton">Scrape</button>

      <div id="listing"></div>

      <div>
        <h2>FAQ</h2>
        <p class="text-bold">Does this support other -ist (LAist, Shanghaiist, etc.) sites?</p>
        <p><strike>Currently no. Right now we're putting out the fires this tool is setting. But we're gonna try to add that as soon as possible if the website formats are similar enough.</strike>
          EDIT: Works on all -ist sites now!</p>
        <p class="text-bold">Why are only some of my articles showing up?</p>
        <p>We don't control what's in the caches. A lot of stuff is already missing. It's trying its hardest!</p>
        <p class="text-bold">What's the deal? How much time do I have to save my work?</p>
        <p>If you see your article on this page, your written content is safe, but any assets (images, videos, etc.) are held on 3rd party CDNs and we cannot guarantee the integrity of those.</p>
        <p class="text-bold">Can't you make it easier to download all my articles at once?</p>
        <p>We're currently more focused on grabbing the content before the caches expire, but we'll get on that as soon as we can!</p>
        <p class="text-bold">Why are none of my articles showing up?</p>
        <p>Ack this makes us sad. Truth is, this whole thing is a hack. We feel lucky it worked at all, for anyone. We're really sorry if our tool can't find your articles.</p>
        <p>Try looking at <a href="http://web.archive.org/web/*/http://gothamist.com/">Wayback Machine</a>, checking <a href="https://docs.google.com/spreadsheets/d/1-EjULY_Ny5I-bt69lZQHl4bVowgahc5zAWtuwCMZr9I/edit#gid=926640332">this spreadsheet</a>, or see what <a href="https://twitter.com/xor">this person is up to</a>. Again, good luck!</p>
      </div>
    </div>

    <script type="text/javascript">
      const submitButton = document.getElementById('submitButton');
      submitButton.onclick = () => {
        const name = document.getElementById('nameInput').value;
        submitButton.disabled = true;

        if (!name) {
          submitButton.disabled = false;
          return alert('You need to enter a name.');
        }

        const fetchOptions = {
          method: 'POST',
          body: JSON.stringify({
            name: name
          }),
          headers: {
            'Content-Type': 'application/json',
          }
        };
        fetch('https://us-central1-gothamist-archive.cloudfunctions.net/scrapeAuthor', fetchOptions)
          .then(() => {
            alert('We are working on downloading your archive (if found) now.');
            submitButton.disabled = false;
          })
          .catch(() => {
            alert('Something went wrong. DM us.');
            submitButton.disabled = false;
          });
      };
    </script>

  <script type="text/javascript">
    var S3BL_IGNORE_PATH = true;
    var BUCKET_NAME = 'amp-archive';
    var BUCKET_URL = 'https://storage.googleapis.com/amp-archive';
    var S3B_SORT = 'A2Z';
    var BUCKET_WEBSITE_URL = 'https://storage.googleapis.com/amp-archive';
    // var EXCLUDE_FILE = 'index.html';
    // var AUTO_TITLE = true;
    // var S3_REGION = 's3'; // for us-east-1
  </script>
  </body>
</html>
